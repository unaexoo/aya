<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•„ì•¼</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon">
        <img src="/static/images/bear-icon.png" alt="Bear Icon">
        <div class="music-notes">ğŸµğŸ¶</div>
      </div>
      <h1>ì–´ë–¤ ì¦ìƒì´ ìˆë‚˜ìš”?</h1>
    </div>
    <div class="textarea-wrapper">
      <textarea id="symptoms" placeholder="ì—¬ê¸°ì— ì¦ìƒì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
    </div>
    <button id="analyze-btn" class="analyze-btn">
      <span class="heart">ğŸ’–</span> ë¶„ì„í•˜ê¸°
    </button>
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
      <div class="spinner"></div>
      <p>ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      $("#analyze-btn").click(function() {
        const symptoms = $("#symptoms").val();
        if (!symptoms) {
          alert("ì¦ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        // ë¡œë”© í‘œì‹œ í™œì„±í™”
        $("#analyze-btn").hide();
        $("#loading-spinner").show();

        // Flask ì„œë²„ì— AJAX ìš”ì²­
        $.ajax({
          url: "/predict",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({ symptoms: symptoms }),
          success: function(response) {
            // ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = `/result?matched_symptoms=${encodeURIComponent(response.matched_symptoms)}&generated_response=${encodeURIComponent(response.generated_response)}`;
          },
          error: function(xhr, status, error) {
            alert("ì˜¤ë¥˜ ë°œìƒ: " + (xhr.responseJSON.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
          },
          complete: function() {
            // ë¡œë”© í‘œì‹œ í•´ì œ (ì˜¤ë¥˜ ì²˜ë¦¬ ëŒ€ë¹„)
            $("#analyze-btn").show();
            $("#loading-spinner").hide();
          }
        });
      });
    });
  </script>
</body>
</html>
